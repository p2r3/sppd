<!DOCTYPE html><html class="default" lang="en" data-base="../"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>EXAMPLES | Scriptable Parser for Portal 2 Demos</title><meta name="description" content="Documentation for Scriptable Parser for Portal 2 Demos"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="../index.html" class="title">Scriptable Parser for Portal 2 Demos</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb" aria-label="Breadcrumb"><li><a href="" aria-current="page">EXAMPLES</a></li></ul></div><div class="tsd-panel tsd-typography"><h1 id="sppd-examples" class="tsd-anchor-link">SPPD Examples<a href="#sppd-examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This document aims to familiarize the reader with SPPD, what it is, and what it can do. This is <em>not</em> an exhaustive <a href="https://p2r3.github.io/sppd">API documentation</a>, but rather a collection of general explanations and practical examples.</p>
<h2 id="prerequisites" class="tsd-anchor-link">Prerequisites<a href="#prerequisites" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>At minimum, SPPD requires just one import:</p>
<pre><code class="ts"><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">Demo</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-8">&quot;./sppd/Demo.ts&quot;</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>Most of the other stuff is internal, though you may also want to import the <code>Vector</code> class:</p>
<pre><code class="ts"><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">Vector</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-8">&quot;./sppd/Vector.ts&quot;</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>This vector implementation, just like the entity interface, should look and feel very similar to that found in Portal 2's VScript. The main difference is the lack of operator overloading (or &quot;metamethods&quot; in Squirrel terms). The alternatives are:</p>
<ul>
<li><code>Sum (other: Vector)</code> - addition;</li>
<li><code>Sub (other: Vector)</code> - subtraction;</li>
<li><code>Scale (factor: number)</code> - multiplication;</li>
<li><code>Clone ()</code> - deep cloning.</li>
</ul>
<h2 id="the-demo-class" class="tsd-anchor-link">The Demo class<a href="#the-demo-class" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>Demo</code> constructor takes two arguments:</p>
<ul>
<li>a <code>Uint8Array</code> with the demo file;</li>
<li>an object of optional event handlers, listed in the example below:</li>
</ul>
<pre><code class="ts"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">demoBytes</span><span class="hl-1">: </span><span class="hl-3">Uint8Array</span><span class="hl-1"> = </span><span class="hl-4">readFileSync</span><span class="hl-1">(</span><span class="hl-8">&quot;path/to/demo.dem&quot;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">demo</span><span class="hl-1">: </span><span class="hl-3">Demo</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-4">Demo</span><span class="hl-1">(</span><span class="hl-5">demoBytes</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-6">// Called once per server tick</span><br/><span class="hl-1">  </span><span class="hl-4">onTick</span><span class="hl-5">:</span><span class="hl-1"> (</span><span class="hl-5">demo</span><span class="hl-1">: </span><span class="hl-3">Demo</span><span class="hl-1">): </span><span class="hl-3">void</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><span class="hl-1"> { },</span><br/><span class="hl-1">  </span><span class="hl-6">// Called on every console command</span><br/><span class="hl-1">  </span><span class="hl-4">onCommand</span><span class="hl-5">:</span><span class="hl-1"> (</span><span class="hl-5">demo</span><span class="hl-1">: </span><span class="hl-3">Demo</span><span class="hl-1">, </span><span class="hl-5">command</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">): </span><span class="hl-3">void</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><span class="hl-1"> { }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Parsing starts and ends with the constructor, so accessing the object outside of any event handlers will yield its final state.</p>
<p>Here's a rough map of the <code>Demo</code> object:</p>
<ul>
<li>Header:
<ul>
<li><code>demoFileStamp: string</code></li>
<li><code>demoProtocol: number</code></li>
<li><code>networkProtocol: number</code></li>
<li><code>serverName: string</code></li>
<li><code>clientName: string</code></li>
<li><code>mapName: string</code></li>
<li><code>gameDirectory: string</code></li>
<li><code>playbackTime: number</code></li>
<li><code>playbackTicks: number</code></li>
<li><code>playbackFrames: number</code></li>
<li><code>signOnLength: number</code></li>
</ul>
</li>
<li>Parsed data:
<ul>
<li><code>messages: Message[]</code></li>
<li><code>state: DemoState</code>
<ul>
<li><code>tick: number</code></li>
<li><code>players: CmdInfo[]</code></li>
<li><code>entities: Entities</code></li>
</ul>
</li>
</ul>
</li>
<li>Internal data:
<ul>
<li><code>buf: DemoBuffer</code></li>
<li><code>dataTables: DataTable[]</code></li>
<li><code>stringTables: Map&lt;string, StringTable&gt;</code></li>
<li><code>serverClasses: ServerClass[]</code></li>
<li><code>parserClasses: ParserClass[]</code></li>
<li><code>baselines: EntityBaseLine[]</code></li>
</ul>
</li>
</ul>
<p>Surface-level information can be gathered from the header, or by looking through the <code>messages</code>. However, for more interactive demo analysis, you'll probably want to use <code>state.entities</code> from within the <code>onTick</code> event handler to interact with in-game objects.</p>
<h2 id="entity-interface" class="tsd-anchor-link">Entity interface<a href="#entity-interface" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The entity interface is designed to mimick Portal 2's VScript as closely as possible. Because of this, the <a href="https://developer.valvesoftware.com/wiki/Portal_2/Scripting/Script_Functions">VDC &quot;List of Portal 2 Script Functions&quot;</a> works as a complimentary documentation to this one.</p>
<p>Below are a few examples to help you get a feel for what it's like to work with this system. Again, if you've used VScript before, this should feel familiar.</p>
<h3 id="reading-properties" class="tsd-anchor-link">Reading properties<a href="#reading-properties" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Printing the positions and angles of all cubes on every tick:</p>
<pre><code class="js"><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-4">Demo</span><span class="hl-1">(</span><span class="hl-5">demoBytes</span><span class="hl-1">, { </span><span class="hl-4">onTick</span><span class="hl-5">:</span><span class="hl-1"> (</span><span class="hl-5">demo</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">// Ensure that entities have loaded</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">entities</span><span class="hl-1"> } = </span><span class="hl-5">demo</span><span class="hl-1">.</span><span class="hl-5">state</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (!</span><span class="hl-5">entities</span><span class="hl-1">) </span><span class="hl-7">return</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// Iterate through all cubes</span><br/><span class="hl-1">  </span><span class="hl-0">let</span><span class="hl-1"> </span><span class="hl-5">ent</span><span class="hl-1"> = </span><span class="hl-0">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-7">while</span><span class="hl-1"> (</span><span class="hl-5">ent</span><span class="hl-1"> = </span><span class="hl-5">entities</span><span class="hl-1">.</span><span class="hl-4">FindByClassname</span><span class="hl-1">(</span><span class="hl-5">ent</span><span class="hl-1">, </span><span class="hl-8">&quot;prop_weighted_cube&quot;</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-6">// Print positions and angles</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">pos</span><span class="hl-1"> = </span><span class="hl-5">ent</span><span class="hl-1">.</span><span class="hl-4">GetOrigin</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">ang</span><span class="hl-1"> = </span><span class="hl-5">ent</span><span class="hl-1">.</span><span class="hl-4">GetAngles</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-4">log</span><span class="hl-1">(</span><span class="hl-5">pos</span><span class="hl-1"> + </span><span class="hl-8">&quot; &quot;</span><span class="hl-1"> + </span><span class="hl-5">ang</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">}});</span>
</code><button type="button">Copy</button></pre>

<p>Logging the position of the blue portal starting from tick 1000:</p>
<pre><code class="js"><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-4">Demo</span><span class="hl-1">(</span><span class="hl-5">demoBytes</span><span class="hl-1">, { </span><span class="hl-4">onTick</span><span class="hl-5">:</span><span class="hl-1"> (</span><span class="hl-5">demo</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">// Don&#39;t do anything until tick 1000</span><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-5">demo</span><span class="hl-1">.</span><span class="hl-5">state</span><span class="hl-1">.</span><span class="hl-5">tick</span><span class="hl-1"> &lt; </span><span class="hl-9">1000</span><span class="hl-1">) </span><span class="hl-7">return</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// Ensure that entities have loaded</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">entities</span><span class="hl-1"> } = </span><span class="hl-5">demo</span><span class="hl-1">.</span><span class="hl-5">state</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (!</span><span class="hl-5">entities</span><span class="hl-1">) </span><span class="hl-7">return</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// Find the blue portal entity by using its model</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">portal</span><span class="hl-1"> = </span><span class="hl-5">entities</span><span class="hl-1">.</span><span class="hl-4">FindByModel</span><span class="hl-1">(</span><span class="hl-0">null</span><span class="hl-1">, </span><span class="hl-8">&quot;models/portals/portal1.mdl&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-5">portal</span><span class="hl-1">) </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-4">log</span><span class="hl-1">(</span><span class="hl-5">portal</span><span class="hl-1">.</span><span class="hl-4">GetOrigin</span><span class="hl-1">().</span><span class="hl-4">toString</span><span class="hl-1">());</span><br/><br/><span class="hl-1">}});</span>
</code><button type="button">Copy</button></pre>

<p>You can also read arbitrary properties like so:</p>
<pre><code class="js"><span class="hl-1">  </span><span class="hl-5">entity</span><span class="hl-1">.</span><span class="hl-4">GetProperty</span><span class="hl-1">(</span><span class="hl-8">&quot;m_CollisionGroup&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>And to retrieve a <code>Map</code> of all available properties and their values:</p>
<pre><code class="js"><span class="hl-1">  </span><span class="hl-5">entity</span><span class="hl-1">.</span><span class="hl-4">GetProperties</span><span class="hl-1">(); </span><span class="hl-6">// Returns Map&lt;name, value&gt;</span>
</code><button type="button">Copy</button></pre>

<h3 id="modifying-properties" class="tsd-anchor-link">Modifying properties<a href="#modifying-properties" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>This parser also lets you <em>modify</em> properties to an extent, effectively letting you edit a demo after it has been recorded. This feature is still very primitive and thus comes with some limitations, namely:</p>
<ul>
<li>Some properties have a fixed range or reduced precision, and others cannot be changed at all.</li>
<li>New deltas aren't created, which means that you cannot animate a prop that's standing still.</li>
</ul>
<p>To check if a value has been modified successfully, read the return value of the setter function. If <code>true</code>, the property was found and the value was set. Even then, it still might not be entirely accurate to your input due to the limitations above.</p>
<p>Note that changes to entity properties are only applied to the buffer, and are <em>not</em> reflected by the parser. To see the factual value of a property after a change, you'll have to parse the demo a second time. This is intentional, as otherwise you'd have to manually keep track of deltas to make relative changes.</p>
<p>Here's an example that rotates every entity 45 degrees on the roll axis:</p>
<pre><code class="js"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">demo</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-4">Demo</span><span class="hl-1">(</span><span class="hl-5">demoBytes</span><span class="hl-1">, { </span><span class="hl-4">onTick</span><span class="hl-5">:</span><span class="hl-1"> (</span><span class="hl-5">demo</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">// Ensure that entities have loaded</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">entities</span><span class="hl-1"> } = </span><span class="hl-5">demo</span><span class="hl-1">.</span><span class="hl-5">state</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (!</span><span class="hl-5">entities</span><span class="hl-1">) </span><span class="hl-7">return</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// Iterate through all entities</span><br/><span class="hl-1">  </span><span class="hl-0">let</span><span class="hl-1"> </span><span class="hl-5">ent</span><span class="hl-1"> = </span><span class="hl-5">entities</span><span class="hl-1">.</span><span class="hl-4">First</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-7">while</span><span class="hl-1"> (</span><span class="hl-5">ent</span><span class="hl-1"> = </span><span class="hl-5">entities</span><span class="hl-1">.</span><span class="hl-4">Next</span><span class="hl-1">(</span><span class="hl-5">ent</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-6">// Get current angles</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">ang</span><span class="hl-1"> = </span><span class="hl-5">ent</span><span class="hl-1">.</span><span class="hl-4">GetAngles</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-6">// Set roll to 45 degrees, keeping the rest the same</span><br/><span class="hl-1">    </span><span class="hl-5">ent</span><span class="hl-1">.</span><span class="hl-4">SetAngles</span><span class="hl-1">(</span><span class="hl-5">ang</span><span class="hl-1">.</span><span class="hl-5">x</span><span class="hl-1">, </span><span class="hl-5">ang</span><span class="hl-1">.</span><span class="hl-5">y</span><span class="hl-1">, </span><span class="hl-9">45</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-6">// Note: this will still be false!!</span><br/><span class="hl-1">    </span><span class="hl-5">ent</span><span class="hl-1">.</span><span class="hl-4">GetAngles</span><span class="hl-1">().</span><span class="hl-5">z</span><span class="hl-1"> === </span><span class="hl-9">45</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">}});</span><br/><br/><span class="hl-6">// Get the modified demo buffer</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">u8array</span><span class="hl-1"> = </span><span class="hl-5">demo</span><span class="hl-1">.</span><span class="hl-5">buf</span><span class="hl-1">.</span><span class="hl-5">bytes</span><span class="hl-1">;</span><br/><span class="hl-6">// Export it to a file</span><br/><span class="hl-5">fs</span><span class="hl-1">.</span><span class="hl-4">writeFileSync</span><span class="hl-1">(</span><span class="hl-8">&quot;output.dem&quot;</span><span class="hl-1">, </span><span class="hl-5">u8array</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Resizing floor buttons to Pi times their original size:</p>
<pre><code class="js"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">demo</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-4">Demo</span><span class="hl-1">(</span><span class="hl-5">demoBytes</span><span class="hl-1">, { </span><span class="hl-4">onTick</span><span class="hl-5">:</span><span class="hl-1"> (</span><span class="hl-5">demo</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">// Ensure that entities have loaded</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">entities</span><span class="hl-1"> } = </span><span class="hl-5">demo</span><span class="hl-1">.</span><span class="hl-5">state</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (!</span><span class="hl-5">entities</span><span class="hl-1">) </span><span class="hl-7">return</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// Iterate through all floor buttons</span><br/><span class="hl-1">  </span><span class="hl-0">let</span><span class="hl-1"> </span><span class="hl-5">ent</span><span class="hl-1"> = </span><span class="hl-0">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-7">while</span><span class="hl-1"> (</span><span class="hl-5">ent</span><span class="hl-1"> = </span><span class="hl-5">entities</span><span class="hl-1">.</span><span class="hl-4">FindByClassname</span><span class="hl-1">(</span><span class="hl-5">ent</span><span class="hl-1">, </span><span class="hl-8">&quot;prop_floor_button&quot;</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-6">// Set the model scale property (only works on certain models)</span><br/><span class="hl-1">    </span><span class="hl-5">ent</span><span class="hl-1">.</span><span class="hl-4">SetProperty</span><span class="hl-1">(</span><span class="hl-8">&quot;m_flModelScale&quot;</span><span class="hl-1">, </span><span class="hl-5">Math</span><span class="hl-1">.</span><span class="hl-2">PI</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">while</span><span class="hl-1"> (</span><span class="hl-5">ent</span><span class="hl-1"> = </span><span class="hl-5">entities</span><span class="hl-1">.</span><span class="hl-4">FindByClassname</span><span class="hl-1">(</span><span class="hl-5">ent</span><span class="hl-1">, </span><span class="hl-8">&quot;prop_under_floor_button&quot;</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-5">ent</span><span class="hl-1">.</span><span class="hl-4">SetProperty</span><span class="hl-1">(</span><span class="hl-8">&quot;m_flModelScale&quot;</span><span class="hl-1">, </span><span class="hl-5">Math</span><span class="hl-1">.</span><span class="hl-2">PI</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">}});</span><br/><br/><span class="hl-5">fs</span><span class="hl-1">.</span><span class="hl-4">writeFileSync</span><span class="hl-1">(</span><span class="hl-8">&quot;output.dem&quot;</span><span class="hl-1">, </span><span class="hl-5">demo</span><span class="hl-1">.</span><span class="hl-5">buf</span><span class="hl-1">.</span><span class="hl-5">bytes</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Swapping cube models with security cameras:</p>
<pre><code class="js"><span class="hl-5">entities</span><span class="hl-1">.</span><span class="hl-4">FindByClassnameAll</span><span class="hl-1">(</span><span class="hl-8">&quot;prop_weighted_cube&quot;</span><span class="hl-1">).</span><span class="hl-4">forEach</span><span class="hl-1">(</span><span class="hl-5">cube</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">success</span><span class="hl-1"> = </span><span class="hl-5">cube</span><span class="hl-1">.</span><span class="hl-4">SetModel</span><span class="hl-1">(</span><span class="hl-8">&quot;models/props/security_camera.mdl&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-6">// `success` is false if the model isn&#39;t precached</span><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (!</span><span class="hl-5">success</span><span class="hl-1">) </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-4">warn</span><span class="hl-1">(</span><span class="hl-8">`Failed to set model on tick </span><span class="hl-0">${</span><span class="hl-5">demo</span><span class="hl-10">.</span><span class="hl-5">state</span><span class="hl-10">.</span><span class="hl-5">tick</span><span class="hl-0">}</span><span class="hl-8">.`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h3 id="miscellaneous-quirks" class="tsd-anchor-link">Miscellaneous quirks<a href="#miscellaneous-quirks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>The <code>entities</code> object can also be accessed like a regular array. It contains all entities, indexed by their entindex:</li>
</ul>
<pre><code class="js"><span class="hl-1">  </span><span class="hl-6">// Index 1 is always the player</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">player</span><span class="hl-1"> = </span><span class="hl-5">demo</span><span class="hl-1">.</span><span class="hl-5">state</span><span class="hl-1">.</span><span class="hl-5">entities</span><span class="hl-1">[</span><span class="hl-9">1</span><span class="hl-1">];</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Every search function (except for <code>FindBy...Nearest</code>) has an &quot;All&quot; variant that omits the first argument, and returns an <em>array</em> of matches:</li>
</ul>
<pre><code class="js"><span class="hl-1">  </span><span class="hl-6">// Returns an array of cube entities</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">cubes</span><span class="hl-1"> = </span><span class="hl-5">entities</span><span class="hl-1">.</span><span class="hl-4">FindByClassnameAll</span><span class="hl-1">(</span><span class="hl-8">&quot;prop_weighted_cube&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<ul>
<li><code>GetClassname</code> may return the <em>server</em> class name (e.g. CBaseViewModel) when the prettier &quot;signifier name&quot; is not available. Consequently, searching by classname with <code>FindByClassname</code> or similar will include results for matching server class names.</li>
</ul>
<h2 id="messages" class="tsd-anchor-link">Messages<a href="#messages" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Demo messages are available via the <code>demo.messages</code> array. Net/Svc messages are stored within their respective Packet/SignOn messages.</p>
<p>Here's an example that counts the amount of times the <code>+jump</code> commmand was called:</p>
<pre><code class="js"><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">Demo</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-8">&quot;./sppd/Demo.ts&quot;</span><span class="hl-1">;</span><br/><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">ConsoleCmdMessage</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-8">&quot;./sppd/Message.ts&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">demo</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-4">Demo</span><span class="hl-1">(</span><span class="hl-5">demoBytes</span><span class="hl-1">);</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">jumps</span><span class="hl-1"> = </span><span class="hl-5">demo</span><span class="hl-1">.</span><span class="hl-5">messages</span><span class="hl-1">.</span><span class="hl-4">filter</span><span class="hl-1">(</span><span class="hl-5">message</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><br/><span class="hl-1">  </span><span class="hl-5">message</span><span class="hl-1"> </span><span class="hl-0">instanceof</span><span class="hl-1"> </span><span class="hl-3">ConsoleCmdMessage</span><br/><span class="hl-1">  &amp;&amp; </span><span class="hl-5">message</span><span class="hl-1">.</span><span class="hl-5">command</span><span class="hl-1">.</span><span class="hl-4">startsWith</span><span class="hl-1">(</span><span class="hl-8">&quot;+jump&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">);</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-4">log</span><span class="hl-1">(</span><span class="hl-5">jumps</span><span class="hl-1">.</span><span class="hl-5">length</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>And here's an example that prints the operating system of the server (yes, demos store that for some reason):</p>
<pre><code class="js"><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">Demo</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-8">&quot;./sppd/Demo.ts&quot;</span><span class="hl-1">;</span><br/><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">PacketMessage</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-8">&quot;./sppd/Message.ts&quot;</span><span class="hl-1">;</span><br/><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">SvcServerInfo</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-8">&quot;./sppd/NetSvcMessage.ts&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">demo</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-4">Demo</span><span class="hl-1">(</span><span class="hl-5">demoBytes</span><span class="hl-1">);</span><br/><br/><span class="hl-7">for</span><span class="hl-1"> (</span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">message</span><span class="hl-1"> </span><span class="hl-0">of</span><span class="hl-1"> </span><span class="hl-5">demo</span><span class="hl-1">.</span><span class="hl-5">messages</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (!(</span><span class="hl-5">message</span><span class="hl-1"> </span><span class="hl-0">instanceof</span><span class="hl-1"> </span><span class="hl-3">PacketMessage</span><span class="hl-1">)) </span><span class="hl-7">continue</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">serverInfo</span><span class="hl-1"> = </span><span class="hl-5">message</span><span class="hl-1">.</span><span class="hl-5">messages</span><span class="hl-1">.</span><span class="hl-4">find</span><span class="hl-1">(</span><span class="hl-5">m</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-5">m</span><span class="hl-1"> </span><span class="hl-0">instanceof</span><span class="hl-1"> </span><span class="hl-3">SvcServerInfo</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-5">serverInfo</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-4">log</span><span class="hl-1">(</span><span class="hl-5">serverInfo</span><span class="hl-1">.</span><span class="hl-5">serverOS</span><span class="hl-1"> === </span><span class="hl-8">&quot;w&quot;</span><span class="hl-1"> ? </span><span class="hl-8">&quot;Windows&quot;</span><span class="hl-1"> : </span><span class="hl-8">&quot;Linux&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">break</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="console-commands" class="tsd-anchor-link">Console commands<a href="#console-commands" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Console commands have a dedicated <code>onCommand</code> event that gets fired whenever a client executes a console command or sets a console variable, or when the server executes commands on the client's behalf.</p>
<p>Here's an example that counts the amount of &quot;+jump&quot; inputs without filtering the raw messages:</p>
<pre><code class="js"><span class="hl-0">let</span><span class="hl-1"> </span><span class="hl-5">jumps</span><span class="hl-1"> = </span><span class="hl-9">0</span><span class="hl-1">;</span><br/><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-4">Demo</span><span class="hl-1">(</span><span class="hl-5">demoBytes</span><span class="hl-1">, { </span><span class="hl-4">onCommand</span><span class="hl-5">:</span><span class="hl-1"> (</span><span class="hl-5">demo</span><span class="hl-1">, </span><span class="hl-5">command</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// Increment `jumps` for each &quot;+jump&quot; command. We use `startsWith` because</span><br/><span class="hl-1">  </span><span class="hl-6">// bound action inputs are usually followed by a key identifier.</span><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-5">command</span><span class="hl-1">.</span><span class="hl-4">startsWith</span><span class="hl-1">(</span><span class="hl-8">&quot;+jump&quot;</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-5">jumps</span><span class="hl-1"> ++;</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">}});</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-4">log</span><span class="hl-1">(</span><span class="hl-5">jumps</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#sppd-examples"><span>SPPD <wbr/>Examples</span></a><ul><li><a href="#prerequisites"><span>Prerequisites</span></a></li><li><a href="#the-demo-class"><span>The <wbr/>Demo class</span></a></li><li><a href="#entity-interface"><span>Entity interface</span></a></li><li><ul><li><a href="#reading-properties"><span>Reading properties</span></a></li><li><a href="#modifying-properties"><span>Modifying properties</span></a></li><li><a href="#miscellaneous-quirks"><span>Miscellaneous quirks</span></a></li></ul></li><li><a href="#messages"><span>Messages</span></a></li><li><a href="#console-commands"><span>Console commands</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">Scriptable Parser for Portal 2 Demos</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
